import{a as l,r as d,j as t}from"./index-07b8d0e5.js";import{u as h}from"./useQuery-f292ed8c.js";import{u as p}from"./useMutation-6209f4bc.js";const x="_title_124wj_1",y={title:x};function j(i){return fetch(`https://jsonplaceholder.typicode.com/comments?postId=${i}`).then(s=>s.json())}async function f(i,s){return await new Promise(o=>setTimeout(o,3e3)),s}function w(){const i=l(),[s,o]=d.useState(1),{data:r,isLoading:m}=h(["post",s],()=>j(s),{staleTime:1e3*60,cacheTime:1e3*60*5}),a=p({mutationFn:e=>f(s,e),onSuccess:async e=>{i.setQueryData(["comments",s],n=>n?[...n,e]:[e]),await new Promise(n=>{setTimeout(n,2e3)}),prompt('"yes"를 입력하면 정말로 새로운 포스트를 받아옵니다!!!')==="yes"&&i.invalidateQueries(["comments",s])},onError(e,c,n){return console.error(e),console.info("context : ",n),r}}),u=()=>{const e={postId:s,id:Math.floor(Math.random()*99999),name:"익명의 사용자",email:"unknown@unknown.com",body:"익명의 댓글입니다."};a.mutate(e)};return t.jsxs("div",{children:[t.jsx("h1",{className:y.title,children:"React queryOptimistic Data Fetching"}),t.jsxs("div",{style:{margin:"30px"},children:[a.isLoading&&t.jsx("div",{children:"데이터를 패칭하고 있습니다... 잠시만 기다려주세요"}),r&&!m&&r.map((e,c)=>t.jsxs("div",{style:{display:"block"},children:[t.jsx("h4",{children:c+1}),t.jsxs("p",{children:["name : ",e.name]}),t.jsxs("span",{children:["body :",e.body.slice(0,10)]})]},e.id)),"------------------------------------------------------------------------------"]}),t.jsxs("div",{style:{margin:"30px"},children:[t.jsxs("div",{style:{margin:"30px"},children:["get post를 누르면 ",t.jsx("h1",{children:s}),"번째 포스트의 댓글이 나옵니다."]}),t.jsx("button",{onClick:()=>o(e=>e+1),children:"Increse Post Number"}),t.jsx("button",{onClick:()=>o(e=>e-1),children:"Decrese Post Number"})]}),t.jsx("div",{style:{margin:"30px"},children:t.jsx("button",{onClick:u,children:"낙관적으로 댓글을 추가해봅시다!"})})]})}export{w as default};
